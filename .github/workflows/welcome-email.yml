name: Send Welcome Email

on:
  repository_dispatch:
    types: [send_welcome_email]

jobs:
  send-welcome:
    runs-on: ubuntu-latest
    steps:
      - name: Send welcome email via SendGrid API
        run: |
          curl -X POST https://api.sendgrid.com/v3/mail/send \
            -H "Authorization: Bearer ${{ secrets.SENDGRID_API_KEY }}" \
            -H "Content-Type: application/json" \
            -d '{
              "personalizations": [{
                "to": [{"email": "${{ github.event.client_payload.email }}"}]
              }],
              "from": {"email": "nathaniel@burnfolder.com", "name": "burnfolder"},
              "subject": "welcome to burnfolder",
              "content": [{
                "type": "text/html",
                "value": "<!DOCTYPE html><html><head><style>body{font-family:monospace;background:#fff;color:#000;padding:40px;line-height:1.6;margin:0}a{color:#000;text-decoration:none;border-bottom:2px solid #000;padding-bottom:2px}.header{font-size:24px;margin-bottom:30px;border-bottom:2px solid #000;padding-bottom:10px}.entries{margin:20px 0}.entry{margin:8px 0}.footer{margin-top:40px;padding-top:20px;border-top:2px solid #000;font-size:12px;opacity:0.6}</style></head><body><div class='header'>burnfolder</div><p>thanks for subscribing.</p><p>you'll receive notifications whenever a new audio entry is posted.</p><div class='entries'><strong>recent entries:</strong><div class='entry'>• <a href='https://burnfolder.com/8.25.html'>8.25</a></div><div class='entry'>• <a href='https://burnfolder.com/9.20.html'>9.20</a></div><div class='entry'>• <a href='https://burnfolder.com/10.22.html'>10.22</a></div></div><p><a href='https://burnfolder.com'>visit burnfolder.com</a></p><div class='footer'>to unsubscribe, reply to this email</div></body></html>"
              }]
            }'
